class deshi{getRef(e){return this.refs[e]?this.refs[e]:(console.warn(`Ref '${e}' not found.`),null)}registerRef(e,t){this.refs[e]=t}handleSuspense(e){let t=e.getAttribute("$suspense"),r=e.querySelector("[placeholder]"),o=e.querySelector("[content]");r&&o?(this.watch(t,(()=>{$[t]?(r.style.display="none",o.style.display=""):(r.style.display="",o.style.display="none")})),$[t]?(r.style.display="none",o.style.display=""):(r.style.display="",o.style.display="none")):console.warn("Missing data-suspense-placeholder or data-suspense-content attribute in $suspense element.")}filters={currency:e=>"number"==typeof e?`$${e.toFixed(2)}`:e,uppercase:e=>"string"==typeof e?e.toUpperCase():e,lowercase:e=>"string"==typeof e?e.toLowerCase():e,titlecase:e=>"string"==typeof e?e.toLowerCase().replace(/\b(\w)/g,(e=>e.toUpperCase())):e,capitalize:e=>"string"==typeof e&&e.length>0?e.charAt(0).toUpperCase()+e.slice(1):e,date(e,t="YYYY-MM-DD"){if(e instanceof Date){let r={year:"numeric",month:"2-digit",day:"2-digit",...formatOptions(t)};return new Intl.DateTimeFormat("en-US",r).format(e)}return e},number:e=>"number"==typeof e?e.toLocaleString():e,percent:(e,t=2)=>"number"==typeof e?`${(100*e).toFixed(t)}%`:e,json(e){try{return JSON.stringify(e,null,2)}catch{return e}},truncate:(e,t=100,r="...")=>"string"==typeof e&&e.length>t?e.substring(0,t)+r:e,pluralize:(e,t)=>"string"==typeof e?1===t?e:`${e}s`:e,stripHtml:e=>"string"==typeof e?e.replace(/<\/?[^>]+>/gi,""):e,escapeHtml:e=>"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):e,rgbToHex(e){if("string"==typeof e&&/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.test(e)){let[t,r,o]=e.match(/\d+/g).map(Number);return`#${[t,r,o].map((e=>e.toString(16).padStart(2,"0"))).join("")}`}return e},phone:e=>"string"==typeof e?e.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"):e,creditCard:e=>"string"==typeof e?e.replace(/(\d{4})(\d{4})(\d{4})(\d{4})/,"$1-$2-$3-$4"):e,bytes(e){if("number"==typeof e){if(0===e)return"0 Byte";let t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,t),2)+" "+["Bytes","KB","MB","GB","TB"][t]}return e},timeAgo(e){if(e instanceof Date){let t=Math.floor((new Date-e)/1e3),r=Math.floor(t/31536e3);if(r>1)return r+" years ago";let o=Math.floor(t/2592e3);if(o>1)return o+" months ago";let n=Math.floor(t/86400);if(n>1)return n+" days ago";let a=Math.floor(t/3600);if(a>1)return a+" hours ago";let i=Math.floor(t/60);return i>1?i+" minutes ago":Math.floor(t)+" seconds ago"}return e},relativeDate(e,t="YYYY-MM-DD"){if(e instanceof Date){let t=new Date,r=Math.floor((t-e)/864e5);return r<30?`${r} days ago`:new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(e)}return e}};formatOptions(e){let t={};return e.includes("YYYY")&&(t.year="numeric"),e.includes("MM")&&(t.month="2-digit"),e.includes("DD")&&(t.day="2-digit"),t}applyFilter(e,t){let r=this.filters[e];return r?r(t):(console.warn(`Filter '${e}' is not defined.`),t)}constructor(){this.listeners={},this.savedKeys=new Set,this.loadState(),this.initializeDataAttributes(),this.refs={},this.$refs=new Proxy({},{get:(e,t)=>this.refs[t]}),this.components={},this.init()}init(){document.querySelectorAll("template[component]").forEach((e=>{let t=e.getAttribute("component");this.components[t]=e.innerHTML,e.remove()})),this.renderComponents()}renderComponents(){Object.keys(this.components).forEach((e=>{document.querySelectorAll(e).forEach((t=>{let r={};Array.from(t.attributes).forEach((e=>{r[e.name]=e.value}));let o=this.components[e];Object.keys(r).forEach((e=>{let t=RegExp(`\\$props\\.${e}`,"g");o=o.replace(t,r[e])}));let n=document.createElement("div");n.innerHTML=o,t.replaceWith(n)}))}))}initializeDataAttributes(){document.querySelectorAll("[\\$data]").forEach((e=>{let t=e.getAttribute("$data");try{let e=JSON.parse(t);Object.keys(e).forEach((t=>{$[t]=e[t],this.makeReactive($)}))}catch(e){console.error("Error parsing $data attribute:",e)}}))}defineReactive(e,t,r){this.listeners[t]=[],Object.defineProperty(e,t,{get:()=>r,set:e=>{r=e,this.notify(t),this.savedKeys.has(t)&&this.saveState()}})}watch(e,t){this.listeners[e]&&this.listeners[e].push(t)}notify(e){this.listeners[e]&&this.listeners[e].forEach((e=>e()))}makeReactive(e){for(let t in e)e.hasOwnProperty(t)&&this.defineReactive(e,t,e[t])}saveState(){try{let e={};this.savedKeys.forEach((t=>{$.hasOwnProperty(t)&&(e[t]=$[t])})),localStorage.setItem("reactiveState",JSON.stringify(e))}catch(e){console.error("Error saving state to localStorage:",e)}}loadState(){try{let e=localStorage.getItem("reactiveState");if(e){let t=JSON.parse(e);Object.keys(t).forEach((e=>{$.hasOwnProperty(e)&&($[e]=t[e])}))}}catch(e){console.error("Error loading state from localStorage:",e)}}}const reactive=new deshi;function initReactiveSystem(){reactive.makeReactive($),document.querySelectorAll("[\\$if]").forEach((e=>{let t=e.getAttribute("$if"),r=e.parentNode,o=document.createComment("$if placeholder");r.insertBefore(o,e);let n=()=>{if($[t]){e.style.display="";let t=e.nextSibling;for(;t&&t.nodeType===Node.COMMENT_NODE;)t=t.nextSibling;for(;t;){let e=t.nextSibling;e&&e.getAttribute&&null!==e.getAttribute("$else")&&(e.style.display="none"),t=t.nextSibling}}else{e.style.display="none";let t=e.nextSibling;for(;t&&t.nodeType===Node.COMMENT_NODE;)t=t.nextSibling;t&&t.getAttribute&&null!==t.getAttribute("$else")&&(t.style.display="")}};reactive.watch(t,n),n()})),document.querySelectorAll("[\\$ref]").forEach((e=>{let t=e.getAttribute("$ref");reactive.registerRef(t,e)})),document.querySelectorAll("[\\$suspense]").forEach((e=>{reactive.handleSuspense(e)})),async function(){let e=document.querySelectorAll("[\\$fetch]");for(let t of e){let e=t.getAttribute("$fetch");try{let r=await fetch(e);if(!r.ok)throw Error(`Network response was not ok: ${r.statusText}`);let o=await r.json();t.querySelectorAll("[\\$fetch-data]").length>0?t.querySelectorAll("[\\$fetch-data]").forEach((e=>{let t=e.getAttribute("$fetch-data");try{let r=Function("data",`return ${t};`)(o);void 0!==r?e.textContent=r:console.warn(`Data path '${t}' not found in fetched data.`)}catch(r){console.error(`Error evaluating data path '${t}':`,r),e.textContent="Error processing data."}})):t.innerHTML=`<pre>${JSON.stringify(o,null,2)}</pre>`}catch(e){console.error("Error fetching data:",e),t.innerHTML="<p>Error fetching data. Please try again later.</p>"}}}(),document.querySelectorAll("[\\$show]").forEach((e=>{let t=e.getAttribute("$show").replace(/{|}/g,"").trim();e.style.display=$[t]?"":"none",reactive.watch(t,(()=>{e.style.display=$[t]?"":"none"}))})),document.querySelectorAll("[\\$focus]").forEach((e=>{let t=e.getAttribute("$focus");reactive.watch(t,(()=>{$[t]&&(e.focus(),applyFocus())})),$[t]&&(e.focus(),applyFocus())})),document.querySelectorAll("[\\$toggle]").forEach((e=>{let t=e.getAttribute("$toggle"),r=e.innerHTML;reactive.watch(t,(()=>{e.innerHTML=$.contentVisible?r:""})),e.innerHTML=$.contentVisible?r:""})),["click","input","change","mouseover","mouseout","keydown","keyup","mousedown","mouseup","dblclick","focus","blur","contextmenu","drag","drop","scroll","resize","touchstart","touchmove","touchend","paste","copy","cut","error","load","submit","animationstart","animationend","animationiteration","transitionend","hashchange","beforeunload","fullscreenchange","message","canplay","canplaythrough","durationchange","emptied","ended","invalid","progress","ratechange","waiting","volumechange","wheel","focusin","focusout","pointerenter","pointerleave","touchcancel"].forEach((e=>{document.querySelectorAll(`[on\\:${e}]`).forEach((t=>{let r=t.getAttribute(`on:${e}`);r&&t.addEventListener(e,(t=>{try{let e=Function("event, reactive","with(this) { return "+r+" }").bind(window)(t,reactive);"function"==typeof e&&e()}catch(t){console.error(`Error executing handler '${r}' for event '${e}':`,t)}}))}))})),document.querySelectorAll("[\\$text]").forEach((e=>{let t=e.getAttribute("$text"),r=()=>{let r=t.replace(/\{(.+?)\}/g,((e,t)=>{try{return Function("with(this) { return "+t+" }").bind($)()}catch(e){return console.error("Error evaluating expression:",t,e),""}}));e.innerText=r};r(),t.match(/\b\w+\b/g).forEach((e=>{$.hasOwnProperty(e)&&reactive.watch(e,r)}))})),document.querySelectorAll("[\\$tooltip]").forEach((e=>{let t=e.getAttribute("$tooltip"),r=document.createElement("div");r.className="tooltip",r.innerText=t,document.body.appendChild(r),e.addEventListener("mouseover",(e=>{r.style.left=`${e.pageX+10}px`,r.style.top=`${e.pageY+10}px`,r.style.display="block"})),e.addEventListener("mouseout",(()=>{r.style.display="none"}))})),document.querySelectorAll("[src]").forEach((e=>{let t=e.getAttribute("src"),r=t.match(/\{(.+?)\}/);if(t.startsWith("{")&&t.endsWith("}")){let r=t.slice(1,-1);reactive.watch(r,(()=>{e.src=$[r]})),e.src=$[r]}else if(r)try{let t=Function("with(this) { return "+r[1]+" }").bind($);e.src=t()}catch(e){console.error("Error evaluating expression:",r[1],e)}})),document.querySelectorAll("[\\$logic]").forEach((e=>{let t=e.getAttribute("$logic"),r=()=>{try{let r=Function("with(this) { return "+t.match(/\{(.+?)\}/)[1]+" }").bind($);e.innerText=r()}catch(e){console.error("Error evaluating logic expression:",t,e)}};t.match(/\b\w+\b/g).forEach((e=>{$.hasOwnProperty(e)&&reactive.watch(e,r)})),r()})),document.querySelectorAll("[\\$delay]").forEach((e=>{let t=parseInt(e.getAttribute("$delay"),10),r=e.getAttribute("on:click");"function"==typeof window[r]&&e.addEventListener("click",(()=>{setTimeout((()=>{window[r]()}),t)}))})),document.querySelectorAll("[\\$bind]").forEach((e=>{e.getAttribute("$bind").split(",").forEach((t=>{let[r,o]=t.split(":");reactive.watch(o,(()=>{e.setAttribute(r,$[o])})),e.setAttribute(r,$[o])}))})),document.querySelectorAll("[\\$save]").forEach((e=>{let t=e.getAttribute("$save").replace(/{|}/g,"").trim();$.hasOwnProperty(t)?(reactive.savedKeys.add(t),reactive.saveState()):console.warn(`State key '${t}' not found.`)})),document.querySelectorAll("[\\$model]").forEach((e=>{let t=e.getAttribute("$model");e.addEventListener("input",(e=>{$[t]=e.target.value})),reactive.watch(t,(()=>{e.value=$[t]})),e.value=$[t]})),document.querySelectorAll("[\\$class]").forEach((e=>{e.getAttribute("$class").split(",").forEach((t=>{let[r,o]=t.split(":");reactive.watch(o,(()=>{$[o]?e.classList.add(r):e.classList.remove(r)})),$[o]?e.classList.add(r):e.classList.remove(r)}))})),document.querySelectorAll("[\\$style]").forEach((e=>{e.getAttribute("$style").split(",").forEach((t=>{let[r,o]=t.split(":");reactive.watch(o,(()=>{e.style[r]=$[o]})),e.style[r]=$[o]}))})),document.querySelectorAll("[\\$attr]").forEach((e=>{e.getAttribute("$attr").split(",").forEach((t=>{let[r,o]=t.split(":");reactive.watch(o,(()=>{e.setAttribute(r,$[o])})),e.setAttribute(r,$[o])}))})),document.querySelectorAll("[\\$for]").forEach((e=>{let t=e.getAttribute("$for"),[r,o]=t.split(" in "),n=e.parentNode,a=document.createComment("$for placeholder");n.insertBefore(a,e),e.remove();let i=()=>{let t=$[o];for(;a.nextSibling&&a.nextSibling!==e;)a.nextSibling.remove();t.forEach((t=>{let o=e.cloneNode(!0);o.innerHTML=o.innerHTML.replace(RegExp(`{${r}}`,"g"),t),n.insertBefore(o,a.nextSibling)}))};reactive.watch(o,i),i()})),document.querySelectorAll("[\\$format]").forEach((e=>{let t=e.getAttribute("$text"),r=e.getAttribute("$format"),o=()=>{let o=t.replace(/\{(.+?)\}/g,((e,t)=>{try{let e=Function("with(this) { return "+t+" }").bind($)();return reactive.applyFilter(r,e)}catch(e){return console.error("Error evaluating expression:",t,e),""}}));e.innerText=o};o(),t.match(/\b\w+\b/g).forEach((e=>{$.hasOwnProperty(e)&&reactive.watch(e,o)}))})),document.querySelectorAll("[\\$html]").forEach((e=>{let t=e.getAttribute("$html"),r=()=>{e.innerHTML=$[t]};reactive.watch(t,r),r()}))}window.$refs=reactive.$refs,document.addEventListener("DOMContentLoaded",initReactiveSystem);